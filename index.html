<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harvey Chandler - Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background-color: #0a0a0a;
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-y: hidden;
        }

        /* Chat container */
        .chat-container {
            max-width: 1200px;
            margin: 60px auto 80px;
            padding: 20px;
            width: 100%;
            height: calc(100vh - 140px);
            overflow-y: auto;
        }

        /* Message bubbles */
        .message {
            margin-bottom: 20px;
            opacity: 0;
            transform: translateY(20px);
            animation: messageAppear 0.3s ease-out forwards;
            padding-left: 55px; /* avatar width + margin */
            position: relative;
            min-height: 40px; /* avatar height */
        }

        .message::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 40px; /* matches avatar width */
            height: 40px; /* matches avatar height */
            margin-right: 15px; /* matches avatar margin */
        }

        /* For messages that actually have avatars */
        .message-header .avatar {
            position: absolute;
            left: 0;
            top: 0;
            z-index: 1;
        }

        .bot-message {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 15px;
            max-width: 80%;
            width: fit-content;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            margin-top: 10px;
            margin-left: 0; /* remove any existing margin */
        }

        /* Typing indicator */
        .typing {
            display: none; /* will be changed to block when in use */
            padding: 15px;
            margin: 0;
            position: fixed;
            bottom: 80px; /* adjust this value if your quick replies height changes */
            left: 0;
            right: 0;
            text-align: center;
            z-index: 100; /* ensure it stays above other elements */
        }
        
        .typing span {
            height: 10px;
            width: 10px;
            background: #333;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
            animation: typing 0.75s infinite ease-in-out;
        }
        
        /* Stagger animation delays for a livelier look */
        .typing span:nth-child(1) {
            animation-delay: 0s;
        }
        .typing span:nth-child(2) {
            animation-delay: 0.13s;
        }
        .typing span:nth-child(3) {
            animation-delay: 0.22s;
        }
        
        @keyframes typing {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
        }

        /* Navigation styled as quick replies */
        .quick-replies {
            position: fixed;
            top: 1%;
            border-radius: 15px;
            left: 0;
            right: 0;
            background: #111;
            padding: 15px;
            display: flex;
            gap: 10px;
            border-top: 1px solid #222;
            max-width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }

        .quick-reply {
            background: #333;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .quick-reply:hover {
            background: #444;
        }

        /* Animations */
        @keyframes messageAppear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Projects grid adjustments for chat */
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 columns by default */
            gap: 20px;
            width: 100%;
        }

        @media (max-width: 768px) {
            .projects-grid {
                grid-template-columns: 1fr; /* Single column on mobile */
                max-width: 100%;
            }
            
            /* Optional: Reduce gap for mobile */
            .projects-grid {
                gap: 15px;
            }
        }

        .projects-grid img {
            width: 100%;
            border-radius: 0px;
        }

        /* Mobile adjustments */
        @media (max-width: 768px) {
            .chat-container {
                margin: 20px auto 60px; /* Reduced bottom margin from 100px to 60px */
                padding: 10px;
            }

            .bot-message {
                max-width: 90%;
            }

            /* Quick replies remain fixed near the bottom */
            .quick-replies {
                top: auto;
                bottom: 1%;
                flex-wrap: wrap;
            }
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .markdown-content {
            background-color: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
            overflow-x: auto;
        }

        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            color: #e0e0e0;
            margin: 1em 0;
        }

        .markdown-content a {
            color: #58a6ff;
            text-decoration: none;
        }

        .markdown-content a:hover {
            text-decoration: underline;
        }

        .markdown-content code {
            background-color: #2d2d2d;
            padding: 2px 4px;
            border-radius: 4px;
        }

        .markdown-content pre {
            background-color: #2d2d2d;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1em 0;
        }

        .markdown-content pre code {
            background: none;
            padding: 0;
        }

        .markdown-content ul, .markdown-content ol {
            margin: 1em 0;
            padding-left: 2em;
        }

        .markdown-content blockquote {
            border-left: 4px solid #444;
            margin: 1em 0;
            padding-left: 1em;
            color: #888;
        }

        .repo-link a {
            color: #58a6ff;
            text-decoration: none;
            font-weight: bold;
        }

        .repo-link a:hover {
            text-decoration: underline;
        }

        a {
            color: rgb(223, 223, 223);text-decoration: underline;
        }

        .markdown-content img {
            max-width: 100%;
            max-height: 30vh; /* Ensures images do not exceed 50% of the viewport height */
            height: auto;
            display: block;
            margin: 15px auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            background-color: #2d2d2d;
            padding: 5px;
            object-fit: contain;
        }

        /* Add this to your CSS */
        .project-item, .project-item img {
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .project-item:hover {
            transform: translateY(-3px);
        }

        /* Custom scrollbar styling */
        .chat-container::-webkit-scrollbar {
            width: 8px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: #2d2d2d;
            border-radius: 4px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: #666;
            border-radius: 4px;
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background: #888;
        }

        /* Firefox support */
        .chat-container {
            scrollbar-width: thin;
            scrollbar-color: #666 #2d2d2d;
        }

        /* Optional: Style body scrollbar too */
        body::-webkit-scrollbar {
            width: 10px;
        }

        body::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        body::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 5px;
        }

        body {
            scrollbar-width: thin;
            scrollbar-color: #444 #1a1a1a;
        }

        /* Delete button inside each chat message */
        .delete-chat {
            position: absolute;
            top: 5px;
            right: 10px;
            cursor: pointer;
            font-size: 18px;
            color: #aaa;
            user-select: none; /* prevents accidental selection */
            z-index: 10;
        }

        .delete-chat:hover {
            color: #fff;
        }
        
        @keyframes messageDisappear {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(20px);
            }
        }

        .message.fade-out {
            animation: messageDisappear 0.3s ease-out forwards;
        }

        /* Desktop adjustments */
        @media (min-width: 769px) {
            .chat-container {
                max-width: 1200px; /* Increase maximum width for desktop */
                margin: 80px auto 80px; /* Slightly larger top margin and bottom margin */
                padding: 30px; /* Increase overall padding */
                height: calc(100vh - 80px); /* Adjust height to give more room */
            }
        }
        
    </style>
</head>
<body>
    <div class="chat-container" id="chatContainer">
        <div class="message">
            <div class="message-header">
                <img src="me.JPG" class="avatar" alt="Harvey Chandler">
                <div class="bot-message">
                    🖥️ Hello! I'm Harvey Chandler.<br>
                    What would you like to see?
                </div>
            </div>
        </div>
             
        <!-- Templates for different message types -->
        <template id="projectsTemplate">
            <div class="bot-message">
                <h3>My Projects</h3>
                <br>
                <div class="projects-grid"></div>
            </div>
        </template>
        
        <!-- Add new template for README content -->
        <template id="readmeTemplate">
            <div class="bot-message">
                <div class="markdown-content"></div>
                <div class="repo-link" style="margin-top: 10px;">
                    <a href="#" target="_blank">View on GitHub →</a>
                </div>
            </div>
        </template>

        <template id="aboutTemplate">
            <div class="bot-message">
                <h3>About Me</h3>
                <p>🎓 Full-time Computer Science student @ University of Kent<br>
                💻 Aspiring Software Engineer<br><br>
                <img src="https://github-readme-stats.vercel.app/api/top-langs/?username=harvey&theme=dark" alt="Languages">
                </p>
            </div>
        </template>

        <template id="contactTemplate">
            <div class="bot-message">
                <h3>Contact</h3>
                <p>📧 <a href="mailto:harveychandler235@gmail.com">harveychandler235@gmail.com</a><br>
                💻 GitHub: <a href="https://github.com/harvey">harvey</a><br>
                🔗 LinkedIn: <a href="https://www.linkedin.com/in/harveychandler">harveychandler</a></p>
            </div>
        </template>
    </div>

    <div class="typing" id="typingIndicator">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <div class="quick-replies">
        <div class="quick-reply" onclick="showSection('projects')">Projects</div>
        <div class="quick-reply" onclick="showSection('about')">About</div>
        <div class="quick-reply" onclick="showSection('contact')">Contact</div>
    </div>

    <script>
        async function showSection(section) {
            const container = document.getElementById('chatContainer');
            const typing = document.getElementById('typingIndicator');
            
            // Show typing indicator immediately
            typing.style.display = 'block';
            
            // Create a message container and hide it initially until images load
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.style.display = 'none'; // Hide the message initially
            
            // Clone the template for the requested section.
            const template = document.getElementById(`${section}Template`);
            const clone = template.content.cloneNode(true);
            
            // Locate the bot-message element inside the clone and add the delete button inside it
            const botMessage = clone.querySelector('.bot-message');
            if (botMessage) {
                // Set relative positioning so delete button positions correctly
                botMessage.style.position = 'relative';
                const deleteButton = document.createElement('span');
                deleteButton.className = 'delete-chat';
                deleteButton.textContent = '×'; // cross icon
                deleteButton.addEventListener('click', () => {
                    // Add fade-out animation class on click
                    messageDiv.classList.add('fade-out');
                    // Once the animation has ended, remove the message from DOM
                    messageDiv.addEventListener('animationend', () => {
                        messageDiv.remove();
                    });
                });
                botMessage.appendChild(deleteButton);
            }
            
            // Process projects section if needed
            if (section === 'projects') {
                const grid = clone.querySelector('.projects-grid');
                const repos = await fetchGitHubRepos('harvey');
                grid.innerHTML = repos;
                
                // Set up click handlers for each project item after DOM update
                grid.querySelectorAll('.project-item').forEach(item => {
                    item.addEventListener('click', handleProjectClick(
                        item.dataset.repo,
                        item.dataset.owner
                    ));
                });
            }
            
            // Append the clone to the message container and to the chat container
            messageDiv.appendChild(clone);
            container.appendChild(messageDiv);
            
            // Wait for all images in the message to load before revealing it
            await waitForImages(messageDiv);
            
            // Hide the typing indicator and show the loaded message
            typing.style.display = 'none';
            messageDiv.style.display = 'block';
            
            // Scroll to the bottom of the chat container.
            container.scrollTop = container.scrollHeight;
        }

        async function fetchGitHubRepos(username) {
            const response = await fetch(`https://api.github.com/users/${username}/repos`);
            const repos = await response.json();
            
            return repos.filter(r => !['harvey.github.io'].includes(r.name))
                .map(repo => `
                    <div class="project-item" data-repo="${repo.name}" data-owner="${username}">
                        <img src="https://github-readme-stats.vercel.app/api/pin/?username=${username}&repo=${repo.name}&theme=dark" alt="${repo.name}">
                    </div>
                `).join('');
        }

        
        function handleProjectClick(repoName, owner) {
            return async function() {
                const typing = document.getElementById('typingIndicator');
                const container = document.getElementById('chatContainer');
                
                // Show typing indicator immediately
                typing.style.display = 'block';
                try {
                    // Fetch README content from GitHub
                    const readmeResponse = await fetch(
                        `https://api.github.com/repos/${owner}/${repoName}/readme`,
                        { headers: { 'Accept': 'application/vnd.github.v3.raw' } }
                    );
                    const readmeContent = await readmeResponse.text();
                    const repoUrl = `https://github.com/${owner}/${repoName}`;
                    
                    // Convert Markdown to HTML
                    const htmlContent = marked.parse(readmeContent);
                    
                    // Clone the readme template and set its content
                    const template = document.getElementById('readmeTemplate');
                    const clone = template.content.cloneNode(true);
                    clone.querySelector('.markdown-content').innerHTML = htmlContent;
                    clone.querySelector('.repo-link a').href = repoUrl;
                    
                    // Create a message container, hide it initially
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message';
                    messageDiv.style.display = 'none'; // Hide until images load
                    
                    // Locate the bot-message element and add the delete button inside it
                    const botMessage = clone.querySelector('.bot-message');
                    if (botMessage) {
                        botMessage.style.position = 'relative';
                        const deleteButton = document.createElement('span');
                        deleteButton.className = 'delete-chat';
                        deleteButton.textContent = '×'; // cross icon
                        deleteButton.addEventListener('click', () => {
                            messageDiv.classList.add('fade-out');
                            messageDiv.addEventListener('animationend', () => {
                                messageDiv.remove();
                            });
                        });
                        botMessage.appendChild(deleteButton);
                    }
                    
                    messageDiv.appendChild(clone);
                    container.appendChild(messageDiv);
                    
                    // Wait until all images within the message have loaded
                    await waitForImages(messageDiv);
                    
                    // Once images are loaded, hide the typing indicator and reveal the message
                    typing.style.display = 'none';
                    messageDiv.style.display = 'block';
                    
                    // Scroll to the bottom of the chat container
                    container.scrollTop = container.scrollHeight;
                    
                    // Double-check scroll position in case layout changed
                    const scrollCheck = () => {
                        const prevHeight = container.scrollHeight;
                        container.scrollTop = container.scrollHeight;
                        if (container.scrollHeight !== prevHeight) {
                            requestAnimationFrame(scrollCheck);
                        }
                    };
                    requestAnimationFrame(scrollCheck);
                } catch (error) {
                    typing.style.display = 'none';
                    const errorMessage = document.createElement('div');
                    errorMessage.className = 'bot-message';
                    errorMessage.innerHTML = `❌ Failed to load README for <strong>${repoName}</strong>: ${error.message}`;
                    container.appendChild(errorMessage);
                    container.scrollTop = container.scrollHeight;
                }
            };
        }

        function waitForImages(element) {
    return new Promise((resolve) => {
        const images = element.getElementsByTagName('img');
        if (images.length === 0) return resolve();

        let loadedCount = 0;
        const totalImages = images.length;

        const checkLoaded = () => {
            loadedCount++;
            
            // Force layout recalculation after each image load
            void element.offsetHeight;
            
            if (loadedCount === totalImages) {
                // Final layout check
                requestAnimationFrame(resolve);
            }
        };

        Array.from(images).forEach(img => {
            if (img.complete) {
                checkLoaded();
            } else {
                img.addEventListener('load', checkLoaded);
                img.addEventListener('error', checkLoaded);
            }
        });
    });
}

    </script>
</body>
</html>